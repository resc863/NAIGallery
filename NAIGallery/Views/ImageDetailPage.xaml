<Page
    x:Class="NAIGallery.Views.ImageDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:NAIGallery.Models"
    KeyDown="Page_KeyDown">
    <Grid RowDefinitions="Auto,*">
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="ImageColumn" Width="*" MinWidth="100" />
            <ColumnDefinition Width="8" />
            <ColumnDefinition x:Name="MetaColumn" Width="400" MinWidth="200" />
        </Grid.ColumnDefinitions>
        <!-- Top bar with Zoom -->
        <StackPanel x:Name="TopBar" Grid.Row="0" Grid.ColumnSpan="3" Orientation="Horizontal" Spacing="12" Padding="8" VerticalAlignment="Center" Opacity="0">
            <TextBlock Text="Zoom" VerticalAlignment="Center"/>
            <Slider x:Name="ZoomSlider" Minimum="0.25" Maximum="8" Value="1" Width="260" ValueChanged="ZoomSlider_ValueChanged" StepFrequency="0.01" SmallChange="0.01" LargeChange="0.5"/>
            <TextBlock x:Name="ZoomValueText" Text="1.00x" VerticalAlignment="Center" />
        </StackPanel>
        <!-- Image host -->
        <Grid Grid.Row="1" Grid.Column="0" Margin="8,0,8,8" x:Name="ImageHost" SizeChanged="ImageHost_SizeChanged" Background="Transparent">
            <Grid.Clip>
                <RectangleGeometry x:Name="HostClip" />
            </Grid.Clip>
            <Canvas x:Name="PanCanvas" Background="Transparent" PointerPressed="PanCanvas_PointerPressed" PointerMoved="PanCanvas_PointerMoved" PointerReleased="PanCanvas_PointerReleased" PointerCanceled="PanCanvas_PointerReleased" PointerExited="PanCanvas_PointerReleased">
                <Image x:Name="DetailImage" Stretch="UniformToFill" RenderTransformOrigin="0.5,0.5" Canvas.Left="0" Canvas.Top="0">
                    <Image.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform x:Name="ImageScale" ScaleX="1" ScaleY="1" />
                            <TranslateTransform x:Name="ImageTranslate" X="0" Y="0" />
                        </TransformGroup>
                    </Image.RenderTransform>
                </Image>
            </Canvas>
            
            <!-- Navigation buttons -->
            <Button x:Name="PrevButton" 
                    Content="&#xE76B;" 
                    FontFamily="Segoe MDL2 Assets" 
                    FontSize="32"
                    HorizontalAlignment="Left" 
                    VerticalAlignment="Center" 
                    Margin="16,0,0,0"
                    Opacity="0.7"
                    Click="PrevButton_Click"
                    PointerEntered="NavButton_PointerEntered"
                    PointerExited="NavButton_PointerExited"
                    Background="{ThemeResource SystemControlAcrylicElementBrush}"
                    Width="60"
                    Height="100"
                    CornerRadius="8">
                <Button.Resources>
                    <ResourceDictionary>
                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#40000000"/>
                        <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#60000000"/>
                    </ResourceDictionary>
                </Button.Resources>
            </Button>
            
            <Button x:Name="NextButton" 
                    Content="&#xE76C;" 
                    FontFamily="Segoe MDL2 Assets" 
                    FontSize="32"
                    HorizontalAlignment="Right" 
                    VerticalAlignment="Center" 
                    Margin="0,0,16,0"
                    Opacity="0.7"
                    Click="NextButton_Click"
                    PointerEntered="NavButton_PointerEntered"
                    PointerExited="NavButton_PointerExited"
                    Background="{ThemeResource SystemControlAcrylicElementBrush}"
                    Width="60"
                    Height="100"
                    CornerRadius="8">
                <Button.Resources>
                    <ResourceDictionary>
                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#40000000"/>
                        <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#60000000"/>
                    </ResourceDictionary>
                </Button.Resources>
            </Button>
        </Grid>
        <!-- Splitter -->
        <Border x:Name="SplitterBorder" Grid.Row="1" Grid.Column="1" Background="#01000000" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Opacity="0"
                PointerPressed="Splitter_PointerPressed" PointerMoved="Splitter_PointerMoved" PointerReleased="Splitter_PointerReleased"
                PointerCanceled="Splitter_PointerReleased" PointerExited="Splitter_PointerReleased" PointerEntered="Splitter_PointerEntered" />
        <!-- Metadata -->
        <ScrollViewer x:Name="MetaScroll" Grid.Row="1" Grid.Column="2" Margin="8,0,8,8" Opacity="0">
            <StackPanel Spacing="8">
                <TextBlock Text="메타데이터" FontSize="20" FontWeight="Bold" />

                <!-- Base prompts (v4) -->
                <StackPanel x:Name="BasePromptSection" Visibility="Collapsed" Spacing="4">
                    <TextBlock Text="Base Prompt" FontWeight="Bold" />
                    <TextBox x:Name="BasePromptText" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" />
                    <TextBlock Text="Base Negative Prompt" FontWeight="Bold" />
                    <TextBox x:Name="BaseNegativePromptText" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" />
                </StackPanel>

                <!-- Character prompts repeater -->
                <StackPanel x:Name="CharacterPromptSection" Visibility="Collapsed" Spacing="4">
                    <TextBlock Text="Character Prompts" FontWeight="Bold" />
                    <ItemsControl x:Name="CharacterPromptsRepeater">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:CharacterPrompt">
                                <StackPanel Spacing="4" Margin="0,6,0,10">
                                    <TextBlock Text="{x:Bind Name}" FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="Prompt" FontWeight="Bold" />
                                    <TextBox Text="{x:Bind Prompt}" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" />
                                    <TextBlock Text="Negative Prompt" FontWeight="Bold" Margin="0,4,0,0" />
                                    <TextBox Text="{x:Bind NegativePrompt}" IsReadOnly="True" TextWrapping="Wrap" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Legacy prompt fields -->
                <TextBlock x:Name="PromptLabel" Text="Prompt" FontWeight="Bold" />
                <TextBox x:Name="PromptText" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" />
                <TextBlock x:Name="NegativePromptLabel" Text="Negative Prompt" FontWeight="Bold" Margin="0,8,0,0" />
                <TextBox x:Name="NegativePromptText" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True" />
                <TextBlock Text="Parameters" FontWeight="Bold" Margin="0,8,0,0" />
                <ItemsRepeater x:Name="ParamsRepeater">
                    <ItemsRepeater.Layout>
                        <StackLayout />
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="models:ParamEntry">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="{x:Bind Key}" FontWeight="Bold" />
                                <TextBlock Text=":" />
                                <TextBlock Text="{x:Bind Value}" />
                            </StackPanel>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>